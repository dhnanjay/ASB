<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link href="./CSS/jqm.css" rel="stylesheet">
    <link href="./CSS/style.css" rel="stylesheet">
  <!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script> -->
    <script src="./scripts/jQuery.js"></script>
    <script src="https://s3.amazonaws.com/codiqa-cdn/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <script src="https://s3.amazonaws.com/codiqa-cdn/codiqa.ext.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js"></script>
    <script src="./scripts/script.js"></script>
    <script>
        // var hGuid = '';
        var sTick = '';
        var gVendorID = '';
        var prd = [];
        $(document).ready(function() {
            $('#usrname').val(localStorage.getItem("usr"));
            $('#pswd').val(localStorage.getItem("pswd"));
        });
        function myfunction(a) {
            sTick = '';
            var b = a.getElementsByTagName("STRONG")[0].textContent;
            var c = b.split("Service Ticket:");
            sTick = c[1];
            var stDesc = a.getElementsByTagName("H3")[0].textContent;
            $('#cName').html('');
            $('#aDdr').html('');
            $('#sT').html('');
            $('#sTDesc').html('');
            $('#pName').html('');
            $('#pNDesc').html('');
            $('#Notes').html('');
            $.ajax({
                url: 'http://colxd136.asa.hq.pvt:8002/sap/bc/webrfc?_FUNCTION=ZFM_MOBILE',
                dataType: 'json',
                type: 'POST',
                async: false,
                cache: false,
                data: {
                    zname: 'SELECT_ST',
                    sTick: sTick
                },
                success: function(data) {
                    // Your Code here
                    try {
                        $('#cName').append(data.PARTNER[0].ZZBUSINESSNA);
                        $('#aDdr').append(data.PARTNER[0].HOUSE_NO + '  ' + data.PARTNER[0].STREET + '  ' + data.PARTNER[0].CITY +
                        '  ' + data.PARTNER[0].REGION + '  ' + data.PARTNER[0].POSTL_COD1 + '<BR>' + 'Phone: ' +
                        data.PARTNER[0].TELEPHONE + '<BR>' + 'Email: ' + data.PARTNER[0].E_MAIL);
                        $('#sT').append(sTick);
                        $('#sTDesc').append(stDesc);
                        $('#pName').append('Product Name: ' + data.PARTNER[0].ORDERED_PROD);
                        $('#pNDesc').append(data.PARTNER[0].DESCRIPTION);
                        $.each(data.TEXT, function(index) { $('#Notes').append(data.TEXT[index].TDLINE); })
                    } // try
                    catch(err) {
                        console.log(err.message);
                    }
                }
            });
        } // Function ends
        function dateFormatter(a) {
            var yR = a.substring(0, 4);
            var mT = a.substring(4, 6);
            mT = parseInt(mT, 10);
            var dY = a.substring(6, 8);
            switch (mT) {
                case 1:
                    mT = "January";
                    break;
                case 2:
                    mT = "February";
                    break;
                case 3:
                    mT = "March";
                    break;
                case 4:
                    mT = "April";
                    break;
                case 5:
                    mT = "May";
                    break;
                case 6:
                    mT = "June";
                    break;
                case 7:
                    mT = "July";
                    break;
                case 8:
                    mT = "August";
                    break;
                case 9:
                    mT = "September";
                    break;
                case 10:
                    mT = "October";
                    break;
                case 11:
                    mT = "November";
                    break;
                case 12:
                    mT = "December";
                    break;
            }
            mT = mT.concat(' ',dY,', ' ,yR)
            return mT;
        }
        $(function() {
            $('#loginbtn').click(function(event) {
                var usr  = $('#usrname').val();
                var pswd = $('#pswd').val();
                var stDate = '';
                sTick = '';
                $.blockUI({ message: '<h3><img src="./CSS/img/slogo.png" /> Please Wait...</h3>',
                    css: { border: '4px solid #6E6E6E',
                        width:   '22%',
                        backgroundColor:'#fff',
                        opacity:     0.2,
                        top:    '25%',
                        left:   '40%' }  });
                $.ajax({
                    url: 'http://colxd136.asa.hq.pvt:8002/sap/bc/webrfc?_FUNCTION=ZFM_MOBILE',
                    dataType: 'json',
                    type: 'POST',
                   // username: 'con_kumard', // Most SAP web services require credentials
                 //   password: 'Nokia123',
                    async: false,
                    cache: false,
                    crossDomain : true,
                 //   xhrFields: {
                 //       withCredentials: true
                 //   },
                    data : {
                        zname: 'LISTPAGE',
                        usr : usr,
                        pswd: pswd
                    },
                    success :  function(data){
                        // Your Code here
                        $.unblockUI();
                        if (data == null) {
                            console.log('Invalid Login');
                            event.preventDefault();
                            $("#usrname").css("background", "#F0DDDD");
                            $("#usrname").css("border", "3px solid #EB6565");
                            $("#pswd").css("background", "#F0DDDD");
                            $("#pswd").css("border", "3px solid #EB6565");
                            return;
                        }
                        var remb = $('#toggleswitch2').val();
                        if (remb == "on") {
                            localStorage.setItem("usr",usr);
                            localStorage.setItem("pswd",pswd);
                            gVendorID = data.VENDORID[0].VENDOR;
                            localStorage.setItem("vendor",gVendorID);
                        }
                        $.each(data.VENDOR, function(index) {
                            if (stDate != data.VENDOR[index].POSTING_DATE ) {
                                var mT = dateFormatter(data.VENDOR[index].POSTING_DATE);
                                $('#listid').append( '<li'+ ' data-role="' + 'list-divider">' + mT + '</li>' );
                            }
                            $('#listid').append( '<li data-theme="' + 'a">' +'<a onClick="' + 'myfunction(this) "' +
                            ' href="' + '#page3"' + 'data-transition="' + 'slide">' +  '<h3>' + data.VENDOR[index].DESCRIPTION +
                            '</h3>' + '<p><strong>Service Ticket: ' +  data.VENDOR[index].OBJECT_ID + '</strong></p></a></li>'   );
                            stDate = data.VENDOR[index].POSTING_DATE;
                        });
                        gVendorID = data.VENDORID[0].VENDOR;
                    }
                })
            });
        });   // function ends
        $(function() {
            $('#helpSubmit').click(function(event) {
                var repagency = $('#repagency').val();
                if (repagency.length == 0) {
                    $("#repagency").css("background", "#F0DDDD");
                    $("#repagency").css("border", "3px solid #EB6565");
                    event.preventDefault();
                    return;
                }
                var emailip = $('#emailip').val();
                var hNote = $('#textarea2').val();
                var usr  = $('#usrname').val();
                var pswd = $('#pswd').val();
                if (usr.length == 0) { user = 'Not Available';}
                if (pswd.length == 0) { pswd = 'Not Available';}
                $.ajax({
                    url: 'http://colxd136.asa.hq.pvt:8002/sap/bc/webrfc?_FUNCTION=ZFM_MOBILE',
                    dataType: 'json',
                    type: 'POST',
                    async: false,
                    cache: false,
                    data: {
                        zname: 'HELP',
                        agency: repagency,
                        email: emailip,
                        text: hNote,
                        usr: usr,
                        pswd: pswd
                    },
                    success: function(data) {
                        // Your Code here
                        $("#repagency").val('');
                        $("#repagency").css("background", "transparent none");
                        $("#repagency").css("border", "0px solid #EB6565");
                        $('#textarea2').val('Forget Password..');
                    }
                })
            });
        }); // function ends
        $(function() {
            $('#confBtn').click(function(event) {
                $('#sku').html('');
                $("#dateip").val('');
                $("#hoursip").val('');
                $("#textarea1").val('');
                prd = [];
                $.ajax({
                    url: 'http://colxd136.asa.hq.pvt:8002/sap/bc/webrfc?_FUNCTION=ZFM_MOBILE',
                    dataType: 'json',
                    cache: false,
                    async: false,
                    data: {
                        zname: 'CONFIRM',
                        vendorid: gVendorID
                    },
                    success: function(data) {
                        // Your Code here
                        if (data == null) {
                            console.log('No SKU for Repair Agents');
                            event.preventDefault();
                        }
                        prd = data.STOCK;
                        $('#dateip').val(cDate());
                        $.each(data.STOCK, function(index) {
                            $('#sku').append('<div class="' + 'ui-block-a"' + '>' + '<div data-controltype="' + 'textblock"' + '>'
                            + '<p><b>' + data.STOCK[index].DESC + '&nbsp;' + '(' + data.STOCK[index].INH_QUANT + ')' + '</b></p></div></div><div class="' + 'ui-block-b"'
                            + '>' + '<div class="' + 'ui-field-contain qnt" ' + 'data-controltype="' + 'textinput"'
                            + '>' + '<input id=' + '"' + data.STOCK[index].SKU + '"' + ' type="' + 'number'
                            + '" data-mini=' + '"true' + '"></div></div>' );
                        });
                    }
                })
            });
        }); // function ends
        $(function() {
            $('#submitBtn').click(function(event) {
                var prdVal = [];
                $.each(prd, function(index) {
                    var uQuan = document.getElementById(prd[index].SKU).value;
                    var pVal = prd[index].SKU + '-' + uQuan;
                    prdVal.push(pVal);
                });
                var dat = document.getElementById('dateip').value;
                var stat = document.getElementById('statusdd').value;
                var hour = $('#hoursip').val();
                var sNote = document.getElementById('textarea1').value;
                if (dat.length == 0) {
                    $("#dateip").css("background", "#F0DDDD");
                    $("#dateip").css("border", "3px solid #EB6565");
                    event.preventDefault();
                    return;
                }
                else if (hour.length == 0) {
                    $("#hoursip").css("background", "#F0DDDD");
                    $("#hoursip").css("border", "3px solid #EB6565");
                    event.preventDefault();
                    return;
                }
                else if (sNote.length == 0) {
                    $("#textarea1").css("background", "#F0DDDD");
                    $("#textarea1").css("border", "3px solid #EB6565");
                    event.preventDefault();
                    return;
                }
                $.ajax({
                    url: 'http://colxd136.asa.hq.pvt:8002/sap/bc/webrfc?_FUNCTION=ZFM_MOBILE',
                    dataType: 'json',
                    type: 'POST',
                    cache: false,
                    //   processData: false,
                    data: {
                        zname: 'SUBMIT',
                        prd: prdVal,
                        date: dat,
                        hour: hour,
                        status: stat,
                        notes: sNote,
                        sTick: sTick,
                        BPID: gVendorID
                    },
                    success: function(data) {
                        // Your Code here

                    }
                })
            });
        }); // function ends
        function cDate() {
            var date = new Date();

// GET YYYY, MM AND DD FROM THE DATE OBJECT
            var yyyy = date.getFullYear().toString();
            var mm = (date.getMonth()+1).toString();
            var dd  = date.getDate().toString();

// CONVERT mm AND dd INTO chars
            var mmChars = mm.split('');
            var ddChars = dd.split('');

// CONCAT THE STRINGS IN YYYY-MM-DD FORMAT
            var datestring = yyyy + '-' + (mmChars[1]?mm:"0"+mmChars[0]) + '-' + (ddChars[1]?dd:"0"+ddChars[0]);
            return (datestring);
        }
    </script>
</head>
<body>
<div data-role="page" data-control-title="Home" id="page1" style="background-color: #ffffff">
    <div data-theme="h" data-role="header">
        <span class="ui-title"></span>
        <img src="./CSS/img/slogo.png" class="ui-btn-right" />
    </div>
    <div role="main" class="ui-content">
        <div style=" text-align:center" data-controltype="image" id="logo">
            <img style="width: 80%; height: 150px" src="./CSS/img/americanstandard-logo.gif">
        </div>
        <div class="ui-field-contain Inputbox" data-controltype="textinput">
            <input name="" id="usrname" placeholder="Username" value="" type="text" required>
        </div>
        <div class="ui-field-contain Inputbox" data-controltype="textinput">
            <input name="" id="pswd" placeholder="Password" value="" type="password" required>
        </div>
        <div class="ui-grid-b">
            <div class="ui-block-a">
                <div class="ui-grid-a">
                    <div class="ui-block-a">
                        <div class="ui-field-contain" data-controltype="toggleswitch">
                            <select name="toggleswitch2" id="toggleswitch2" data-theme="h" data-role="slider"
                                    data-mini="true">
                                <option value="off">
                                    No
                                </option>
                                <option value="on">
                                    Yes
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="ui-block-b">
                    </div>
                </div>
            </div>
            <div class="ui-block-b">
                <div data-controltype="textblock">
                    <p>
                        <span style="color: #059;" data-mce-style="color: #059;">
                            <strong>
                                <span style="font-size: small;" data-mce-style="font-size: small;">
                                    Remember Me
                                </span>
                            </strong>
                        </span>
                    </p>
                </div>
            </div>
            <div class="ui-block-c">
            </div>
        </div>
        <a id="loginbtn" data-transition="turn" href="#page2" data-icon="arrow-r"
           data-iconpos="right" class="ui-btn ui-btn-h ui-icon-arrow-r ui-btn-icon-right Btns">
            Login
        </a>
        <div>
            <a id="helpLink" href="#page5" data-transition="flip" class="link">
                Help
            </a>
        </div>
    </div>
</div>
<div data-role="page" data-control-title="jobList" id="page2" style="background-color: #ffffff">
    <div data-theme="a" data-role="header">
        <h1 id="pg2" class="ui-title hdr"></h1>
        <img src="./CSS/img/slogo.png" class="ui-btn-right" />
    </div>
    <div role="main" class="ui-content">
        <div data-controltype="textblock">
            <h3 style="text-align: center;" data-mce-style="text-align: center;">
                <span style="color: #059;" data-mce-style="color: #059;">
                    <b>
                        Pending Jobs
                    </b>
                </span>
            </h3>
        </div>
        <ul id="listid" data-role="listview" data-divider-theme="a" data-inset="true">

        </ul>
    </div>
    <div data-theme="h" data-role="footer" data-position="fixed">
        <h3 id="ftr2" class="ui-title footer">
        </h3>
    </div>
</div>
<div data-role="page" data-control-title="stInfo" id="page3" style="background-color: #ffffff">
    <div id="pg3" data-theme="a" data-role="header" class="hdr">
        <span class="ui-title"></span>
        <a id="backbtn1" data-inline="true" data-rel="back" href="#page2" data-icon="back"
           data-iconpos="left" class="ui-btn  ui-icon-back ui-btn-icon-left back">
        </a>
        <img src="./CSS/img/slogo.png" class="ui-btn-right" />
    </div>
    <div role="main" class="ui-content">

        <!-- -->
        <ul id="custinfo" data-role="listview" data-divider-theme="a" data-inset="true">
            <li data-role="list-divider"> Customer Name </li>
            <li data-theme="a">
                <h3 id="cName"> </h3>
                <p id="aDdr">  </p>
                <p class="ui-li-aside"> </p>
                <!--   <p class="ui-li-aside"><img style="width: 25%; height: 55px" src="./css/img/hyatt-logo.jpg"></p> -->
            </li>
            <li data-role="list-divider"> Service Ticket </li>
            <li data-theme="a">
                <h3 id="sT"> </h3>
                <p id="sTDesc">  </p>
            </li>
            <li data-role="list-divider"> Product Information </li>
            <li data-theme="a">
                <h3 id="pName">  </h3>
                <p id="pNDesc"> </p>
            </li>
            <li data-role="list-divider"> Notes </li>
            <li data-theme="a">
                <p id="Notes"> </p>
            </li>
        </ul>
        <!-- -->
        <a id="confBtn" data-transition="pop" href="#page4" class="ui-btn ">
            Confirm
        </a>
    </div>
    <div data-theme="a" data-role="footer" data-position="fixed">
        <h3 class="ui-title">
        </h3>
    </div>
</div>
<div data-role="page" data-control-title="capData" id="page4">
    <div data-theme="a" data-role="header" class="hdr">
        <span class="ui-title"></span>
        <a id="backbtn2" data-rel="back" href="#page4" data-icon="back" data-iconpos="left"
           class="ui-btn ui-btn-left ui-icon-back ui-btn-icon-left back">
        </a>
        <img src="./CSS/img/slogo.png" class="ui-btn-right" />
    </div>
    <div role="main" class="ui-content">
        <div class="ui-field-contain" data-controltype="dateinput">
            <label for="dateip">
                Date
            </label>
            <input name="" id="dateip" placeholder="" value="" type="date">
        </div>
        <div class="ui-field-contain" data-controltype="textinput">
            <label for="hoursip">
                Hours
            </label>
            <input name="" id="hoursip" placeholder="Enter Hours" value="" type="time">
        </div>
        <div class="ui-field-contain" data-controltype="selectmenu">
            <label for="statusdd">
                Status
            </label>
            <select id="statusdd" name="">
                <option value="E0001">
                    Open
                </option>
                <option value="E0002">
                    In Process
                </option>
                <option value="E0006">
                    Closed with Cust. Satisfaction
                </option>
                <option value="E0007">
                    Closed without Cust. Satisfaction
                </option>
            </select>
        </div>
        <div id="collapsid" data-role="collapsible-set">
            <div id="sectionid" data-role="collapsible" data-collapsed="false">
                <h3>
                    Products Available
                </h3>
                <div id="sku" class="ui-grid-a">
                </div>
            </div>
        </div>
        <div class="ui-field-contain" data-controltype="textarea">
            <label for="textarea1">
                Notes
            </label>
            <textarea maxlength="250" name="" id="textarea1" placeholder=""></textarea>
        </div>

        <!--   <input id="submitBtn" class="show-page-loading-msg" type="submit" value="Submit"> -->
        <a id="submitBtn" data-transition="pop" href="#page2" class="ui-btn ">
            Submit
        </a>
    </div>

</div>
<div data-role="page" data-control-title="Help" id="page5">
    <div data-theme="a" data-role="header">
        <span class="ui-title"></span>
        <a id="backbtn3" data-rel="back" data-transition="slide" href="#page1"
           data-icon="back" data-iconpos="left" class="ui-btn ui-btn-left ui-icon-back ui-btn-icon-left back">
        </a>
        <img src="./CSS/img/slogo.png" class="ui-btn-right" />
    </div>
    <div role="main" class="ui-content">
        <div class="ui-field-contain" data-controltype="textinput">
            <label for="repagency">
                Repair Agency Name
            </label>
            <input name="" id="repagency" placeholder="Agency Name" value="" type="text" required>
        </div>
        <div class="ui-field-contain" data-controltype="textinput">
            <label for="emailip">
                Email
            </label>
            <input name="" id="emailip" placeholder="Email" value="" type="email">
        </div>
        <div class="ui-field-contain" data-controltype="textarea">
            <label for="textarea2">
                Comments
            </label>
            <textarea maxlength="250" name="" id="textarea2" placeholder="Enter your query here..">Forget Password..</textarea>
        </div>
        <a id="helpSubmit" data-transition="flip" href="#page1" class="ui-btn ">
            Submit
        </a>
        <br>
        <a id="helpCancel" data-transition="flip" href="#page1" class="ui-btn ">
            Cancel
        </a>
    </div>
</div>
</body>
</html>